<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd">
    <bean id="historyAuthProcessor"
        class="edu.stanford.irt.eresources.MARCEresourceProcessor">
        <property name="inputStream">
            
            <bean id="eresourcesInputStream" class="edu.stanford.irt.eresources.AuthHistoryInputStream">
                <property name="dataSource" ref="voyagerDataSource"/>
                <property name="executor" ref="executor"/>
                <property name="bibQuery">
                    <value>
WITH BIBS AS
  (SELECT BIB_ID
  FROM CIFDB.BIB_MASTER
  WHERE BIB_MASTER.SUPPRESS_IN_OPAC != 'Y'
  AND ((update_date                 IS NULL
  AND create_date                    > ?)
  OR update_date                     > ?)
  )
SELECT BIBS.BIB_ID
FROM BIBS,
  CIFDB.BIB_INDEX
WHERE BIBS.BIB_ID    = BIB_INDEX.BIB_ID
AND INDEX_CODE       = '655H'
AND ( NORMAL_HEADING LIKE 'PERSON %'
OR NORMAL_HEADING    = 'ORGANIZATION'
OR NORMAL_HEADING    = 'EVENT'
OR NORMAL_HEADING    = 'PEOPLES' )
                    </value>
                </property>
            </bean>
        </property>
        <property name="xmlReader">
            <bean class="edu.stanford.lane.catalog.impl.xml.UTF8ComposingMarcReader">
                <property name="contentHandler" ref="authEresourceBuilder"/>
            </bean>
        </property>
    </bean>
    <bean id="authEresourceBuilder" class="edu.stanford.irt.eresources.AuthHistoryEresourceBuilder">
        <property name="eresourceHandler" ref="eresourceHandler"/>
    </bean>
</beans>
