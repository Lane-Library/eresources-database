<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd">
    <import resource="history-db-load.xml"/>
    <bean id="dbLoader" class="edu.stanford.irt.eresources.DBLoader" parent="abstractDbLoader">
        <property name="killPrevious" value="true"/>
        <property name="handler" ref="eresourceHandler"/>
        <property name="createStatements">
            <list>
                <value>DROP SEQUENCE H_ERESOURCE_ID_SEQ</value>
                <value>DROP SEQUENCE H_VERSION_ID_SEQ</value>
                <value>DROP SEQUENCE H_LINK_ID_SEQ</value>
                <value>DROP INDEX H_TYPE_IDX</value>
                <value>DROP INDEX H_TYPE_TYPE_IDX</value>
                <value>DROP INDEX H_VERSION_IDX</value>
                <value>DROP INDEX H_LINK_IDX</value>
                <value>DROP INDEX H_TEXT_IDX</value>
                <value>DROP INDEX H_TITLE_IDX</value>
                <value>DROP INDEX H_SUBSET_IDX</value>
                <value>DROP INDEX H_SUBSET_VERSION_IDX</value>
                <value>DROP INDEX H_SUBSET_SUBSET_IDX</value>
                <value>DROP INDEX H_MESH_IDX</value>
                <value>DROP INDEX H_MESH_TERM_IDX</value>
                <value>DROP TABLE H_ERESOURCE</value>
                <value>DROP TABLE H_VERSION</value>
                <value>DROP TABLE H_LINK</value>
                <value>DROP TABLE H_TYPE</value>
                <value>DROP TABLE H_SUBSET</value>
                <value>DROP TABLE H_MESH</value>
                <value>CREATE SEQUENCE H_ERESOURCE_ID_SEQ MAXVALUE 99999999 CYCLE</value>
                <value>CREATE SEQUENCE H_VERSION_ID_SEQ MAXVALUE 99999999 CYCLE</value>
                <value>CREATE SEQUENCE H_LINK_ID_SEQ MAXVALUE 99999999 CYCLE</value>
                <value>CREATE TABLE H_ERESOURCE (ERESOURCE_ID NUMBER(8,0) PRIMARY KEY, RECORD_ID
                    NUMBER(12,0), RECORD_TYPE VARCHAR2(8), UPDATED DATE, TITLE VARCHAR2(512),
                    CORE CHAR(1), YEAR NUMBER(4,0), DESCRIPTION CLOB, TEXT CLOB)</value>
                <value>CREATE TABLE H_VERSION (VERSION_ID NUMBER(8,0) PRIMARY KEY, ERESOURCE_ID
                    NUMBER(8,0), PUBLISHER VARCHAR2(256), HOLDINGS VARCHAR2(256), DATES
                    VARCHAR2(256), DESCRIPTION VARCHAR2(256), PROXY CHAR(1), GETPASSWORD CHAR(1), SEQNUM NUMBER(2,0))</value>
                <value>CREATE TABLE H_LINK (LINK_ID NUMBER(8,0) PRIMARY KEY, VERSION_ID NUMBER(8,0),
                    ERESOURCE_ID NUMBER(8,0), LABEL VARCHAR2(256), URL VARCHAR2(1200), INSTRUCTION
                    VARCHAR2(256))</value>
                <value>CREATE TABLE H_TYPE (ERESOURCE_ID NUMBER(8,0), TYPE VARCHAR2(256))</value>
                <value>CREATE TABLE H_SUBSET (VERSION_ID NUMBER(8,0), ERESOURCE_ID NUMBER(8,0), SUBSET
                    VARCHAR(256))</value>
                <value>CREATE TABLE H_MESH (ERESOURCE_ID NUMBER(8,0), TERM VARCHAR2(256))</value>
                <value>CREATE INDEX H_MESH_IDX ON H_MESH(ERESOURCE_ID)</value>
                <value>CREATE INDEX H_MESH_TERM_IDX ON H_MESH(TERM)</value>
                <value>CREATE INDEX H_SUBSET_IDX ON H_SUBSET(ERESOURCE_ID)</value>
                <value>CREATE INDEX H_SUBSET_VERSION_IDX ON H_SUBSET(VERSION_ID)</value>
                <value>CREATE INDEX H_SUBSET_SUBSET ON H_SUBSET(SUBSET)</value>
                <value>CREATE INDEX H_TYPE_IDX ON H_TYPE(ERESOURCE_ID)</value>
                <value>CREATE INDEX H_TYPE_TYPE_IDX ON H_TYPE(TYPE)</value>
                <value>CREATE INDEX H_VERSION_IDX ON H_VERSION(ERESOURCE_ID)</value>
                <value>CREATE INDEX H_LINK_IDX ON H_LINK(VERSION_ID)</value>
                <value>CREATE INDEX H_TEXT_IDX ON H_ERESOURCE(TEXT) INDEXTYPE IS CTXSYS.CONTEXT</value>
                <value>CREATE INDEX H_TITLE_IDX ON H_ERESOURCE(TITLE) INDEXTYPE IS CTXSYS.CONTEXT</value>
            </list>
        </property>
        <property name="callStatements">
            <list>
                <value>{ call ctx_ddl.sync_index('H_TEXT_IDX') }</value>
                <value>{ call ctx_ddl.optimize_index('H_TEXT_IDX','FULL') }</value>
                <value>{ call ctx_ddl.sync_index('H_TITLE_IDX') }</value>
                <value>{ call ctx_ddl.optimize_index('H_TITLE_IDX','FULL') }</value>
                <value>'{' call dbms_stats.gather_schema_stats(ownname=>''{0}'', cascade=>TRUE,estimate_percent => dbms_stats.auto_sample_size)'}'</value>
            </list>
        </property>
    </bean>
    <bean id="eresourceHandler" class="edu.stanford.irt.eresources.DefaultEresourceHandler">
        <constructor-arg ref="erdbDataSource"/>
        <constructor-arg ref="queue"/>
        <constructor-arg>
            <bean class="edu.stanford.irt.eresources.EresourceSQLTranslator">
                <constructor-arg value="H_"/>
            </bean>
        </constructor-arg>
        <constructor-arg value="H_"/>
    </bean>
</beans>
